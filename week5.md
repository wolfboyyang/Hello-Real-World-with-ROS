# Week5 - Practical Assignment

## Practical Assignment 1

**Install and configure Logical cameras**

In Module 5.1, the Logical camera was introduced. We also learned that models can be added to Gazebo world files and we saw how different models were included in the hrwros.world file.

In this assignment you will get a chance to implement the theory you learned during this week by installing and configuring two  new logical cameras in the factory simulation. The first camera will be above the conveyor belt near robot1, like it was shown in video lecture 5.1.1 and the second camera will be near the second robot where the TurtleBot is expected to deliver the object.

Those models and world files are included in the hrwros_week5_assignment package

This assignment will consist of two parts, first you will add the cameras to the a new world file, and then you will configure the models.

### Week 5 - Assignment 1 - part 1 (of 2)

In the assignment package of this week, the two new logical camera models have been included, named new_logical_camera1 and new_logical_camera2. You can find them in the hrwros_week5_assignment/models folder

In the first part of this assignment, you only need to edit the week5_assignment1.world file, found it in the hrwros_week5_assignment/worlds folder.

Add the two new models in the following  poses:
* Position of the new logical camera 1:   1.2  1.80  2.0
* Orientation of the new logical camera 1:   0 1.57  0
* Position of the new logical camera 2:  -8.3 -1.23 1.8
* Orientation of the new logical camera 2:   0 1.57  0

Once you have added the new models, Remember to save the .world file  and continue to the part 2 of the assignment.

### Week 5 - Assignment 1 - part 2 (of 2)

As we learned in the lectures, Just adding the cameras is not sufficient because we cannot use them without configuring them before.

So, in this part we will do that. For this you will have to update the model.sdf files in the folders for each new logical camera. 
You need to add your code wherever you are instructed to <write_code_here>.

The following configuration parameters are desired:

**Configuration for new logical camera 1**:

* Model name:    new_logical_camera_1
* Link name:        new_logical_camera_1_link
* Sensor name:   new_logical_camera_1

**Configuration for new logical camera 2**:

* Model name:    new_logical_camera_2
* Link name:        new_logical_camera_2_link
* Sensor name:   new_logical_camera_2

After you have completed all the changes in the two  model.sdf files  you can tests the new models by following the steps below:

**Step 1**: Launch the week5_assignment1 environment:
```sh
roslaunch hrwros_week5_assignment week5_assignment1.launch
```
After the simulation comes up, you should see the new cameras on top of the two robots in Gazebo.

**Step 2**: Check that the new topics are present and that they are publishing some data.

Use tools you have learned from the first week, like rostopic list, rostopic info, rostopic echo, etc. To check that the topics exist and that the cameras are actually publishing some data, also take time to explore the knowledge you have acquired so far. 

You might understand that we cannot give you every single command :)

This completes the first assignment of this week!

## Practical Assignment 2: TF command line tools

**TF command line tools**

In this second assignment you will get a chance to implement the theory about the TF package that you have learned during this week.
We learned about three different TF command line tools in the videos 5.3.1 and 5.3.2, namely tf_echo, view_frames and static_transform_publisher.

In this assignment we will explore some of those command line tools.

Important Note:
**For this assignment to work, you need to have completed assignment 1.**

### Week 5 - Assignment 2 - part 1 (of 2)

This part of the assignment is very simple, it's intended  to remind you of the usage if the view_frames and tf_echo command line tools.

For this you need to test some commands on the prompt and then put them in a launch file.

**Step 1**: Launch the completed factory simulation, using the launcher for assignment 1:            
```sh
roslaunch hrwros_week5_assignment week5_assignment1.launch
```
Note:  If you have not completed assignment 1 this may not work.

**Step 2**: run the view_frames command, you should know how to complete this
```sh
rosrun <correct package> <correct node name>
```
**Step 3**: Open the frames.pdf file generated by the command.

Verify that the TF frames new_logical_camera_1_frame and new_logical_camera_2_frame are now a part of the TF tree and that the entire TF tree is connected

**Step 4**: run the tf_echo command, to get the transformation between the new_logical_camera_2_frame and the camera_rgb_frame.

You should know how to complete this:
```sh
rosrun <correct package> <correct node name> <correct argument> <correct argument>
```
You will first see some warnings and eventually the tf_echo command will start printing the TF information between the above-mentioned frames.

Now that you know and have tested the commands, let's put them on a launch file.

**Step 5**: Edit the week5_assignment2_part1.launch file, you will find it in the in the hrwros_week5_assignment/launch folder.

You will find the <add-solutiontion-here> marks corresponding to this part.

**Step 6**: Once it's completed test the launch file with
```sh
roslaunch hrwros_week5_assignment week5_assignment2_part1.launch
```
It should just re-do the previous steps. Please notice that when you use this launch file, the pdf would not be generated at the same place as in Step 3. In order to check if you did this correctly, you can go to the directory ~/.ros and find out if the pdf is generated there.

You can now  continue to the part 2 of the assignment.

### Week 5 - Assignment 2 - part 2 (of 2)

In this part you will use the static_transform_publisher to create a new transformation, and we will visualize it in RViz.

The goal is to publish a new static transform between the plate_top_link and a new frame called turtlebot_object_top which will be located 30cm on top of the TurtleBot. As with the previous, part  you will test some the commands on the prompt and then put them in a launch file.

**Step 1**: Make sure, you terminate the factory simulation and any other CCS that may be running.

**Step 2**: Re-start the factory simulation without the Gazebo gui and starting RViz (we can do this with the launch arguments). 
```sh
roslaunch hrwros_week5_assignment week5_assignment1.launch gui:=false rviz:=true
```
**Step 3**: Make sure you enable the TF visualization such that only the plate_top_link frame is shown.

**Step 4**:  On a new CCS, publish a static transform from the plate_top_link to a new child frame named turtlebot_object_top.

The turtlebot_object_top frame should be 0.3 m above the plate_top_link with the same orientation.

Now we can publish a new static transformation:
```sh
   rosrun <correct package> <correct node name> <correct arguments>
```

Note: You can review  in unit 5.3.2 how to use the static_transform_publisher command line tool

**Step 5**: Go back to RViz and enable the newly published frame turtlebot_object_top. It should show up exactly on top of the reference frame for plate_top_link.

**Step 6**: In a new CCS, start the turtlebot teleoperation with:
```sh
   roslaunch turtlebot_teleop keyboard_teleop.launch
```
Move the TurtleBot around with the keyboard to a different location of your choice, you should notice that the newly published TF frame turtlebot_object_top moves along with the TurtleBot.

**Step 7**: Now that you know and have tested the commands, let's put them on a launch file.

Edit the week5_assignment2_part2.launch file, you will find it in the in the hrwros_week5_assignment/launch folder. You will find the <add-solutiontion-here> marks corresponding to this part.

**Step 8**: Once it's completed, test the launch file with
```sh
roslaunch hrwros_week5_assignment week5_assignment2_part2.launch
```
You should be able to see same results as with the previous steps.

This completes the second assignment of week 5!

## Practical Assignment 3: The transform API

**Transform API (tf2_ros)**

In this assignment you will use the tf2_ros transform API you studied in units 5.3.3 to 5.3.5

The objective is to transform the pose of an object which is on top of the TurtleBot to the vacuum_gripper2_suction_cup reference frame.

Important Note:
**For this assignment to work, you need to have completed assignment 1.**

### Week 5 - Assignment 3

In this assignment, you will need to complete the week5_assignment3_script.py file, that you can find in hrwros_week5_assignment/scripts folder.

As always, you only need to edit where you are instructed with <write your code here>.

Once completed, the script should do the following tasks:

* Subscribe to the relevant topic, published by the new_logical_camera_2 you added in assignment 1.
It should publish information about the object on top of the TurtleBot.
* Update the relevant reference frame for the pose of the object.
(Hint: You can use the view_frames command and TF tree to find out what name should be used for the reference frame.)
* Transform the pose of the object to the vacuum_gripper2_suction_cup reference frame.

After you finish editing the script, you can test your solution by executing the following steps:

**Step 1**: Make sure, you terminate the factory simulation and any other CCS that may be running.

**Step 2**: Start the assignment specific factory simulation.
```sh
roslaunch hrwros_week5_assignment week5_assignment3.launch
```
We have modified some configurations of the factory for this assignment.

Please Verify that the Turtlebot now shows up right next to Robot2 pedestal under the newly installed logical camera.

**Step 3**.  Call the spawn_object_on_turtlebot service with:
```sh
rosservice call /spawn_object_on_turtlebot
```
After this, you should see a white box show up on top of the TurtleBot.

**Step 4**.  Move the robot2 to the R2PreGrasp pose.

To do this, start a new CCS and run the MoveIt! commander script from Week4 with:
```sh
rosrun hrwros_week4 hrwros_moveit_commander_cmdline
```
Then select robot2 and move it to R2PreGrasp (You should know how to do this by now):

Step 5. Run the now completed week5_assignment3.py 
```sh
rosrun hrwros_week5_assignment week5_assignment3.py
```
The transformed pose of the object should be printed on the CCS.

This completes the third and final assignment of week 5!

As with previous weeks, you can now go to the submission unit and upload all the assignments of this week.

**Optional (additional steps)**

And now, time for some fun! Since the object is not yet picked up by robot2, let's help it get it into the bin!

Go back to the factory simulation in Gazebo, and click on the white box on top of the TurtleBot. Now, right-click and you will see an option to apply force. Click on it and then, enter the forces.

Now click on Apply Force and you should see the box jump into the bin! Gazebo is a physics engine, so feel free to apply forces on any object in the factory scene that Gazebo knows about and have fun. If you manage to break down the simulation at some point, just restart it and you will be fine!